(this["webpackJsonpgo-movies"]=this["webpackJsonpgo-movies"]||[]).push([[0],{30:function(e,t,n){},40:function(e,t,n){},42:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),c=n(21),r=n.n(c),i=(n(30),n(9)),l=n(2),o=n(3),j=n(4),d=n(13),h=n(14),m=n(15),b=n(16),u=n(18),O=n(0),p=function(e){return Object(O.jsxs)("div",{className:"mb-3",children:[Object(O.jsx)("label",{htmlFor:e.name,className:"form-label",children:e.title}),Object(O.jsx)("input",{type:e.type,className:"form-control ".concat(e.className),id:e.name,name:e.name,value:e.value,onChange:e.handleChange,placeholder:e.placeholder}),Object(O.jsx)("div",{className:e.errorDiv,children:e.errorMsg})]})},v=function(e){Object(b.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).handleChange=function(e){var t=e.target.value;a.setState((function(e){return{searchTerm:t}})),t.length>2?a.performSearch():a.setState({movies:[]})},a.state={movies:[],isLoaded:!1,error:null,alert:{type:"d-none",message:""},searchTerm:""},a.handleChange=a.handleChange.bind(Object(m.a)(a)),a}return Object(h.a)(n,[{key:"performSearch",value:function(){var e=this,t='\n        {\n            search(titleContains: "'.concat(this.state.searchTerm,'") {\n                id\n                title\n                runtime\n                year\n                description\n            }\n        }\n        '),n=new Headers;n.append("Content-Type","application/json");var a={method:"POST",body:t,headers:n};fetch("".concat("https://api.myqwerty.ru/v1","/graphql"),a).then((function(e){return e.json()})).then((function(e){return Object.values(e.data.search)})).then((function(t){t.length>0?e.setState({movies:t}):e.setState({movies:[]})}))}},{key:"componentDidMount",value:function(){var e=this,t=new Headers;t.append("Content-Type","application/json");var n={method:"POST",body:"\n        {\n            list {\n                id\n                title\n                runtime\n                year\n                description\n            }\n        }\n        ",headers:t};fetch("".concat("https://api.myqwerty.ru/v1","/graphql"),n).then((function(e){return e.json()})).then((function(e){return Object.values(e.data.list)})).then((function(t){e.setState({movies:t})}))}},{key:"render",value:function(){var e=this.state.movies;return Object(O.jsxs)(a.Fragment,{children:[Object(O.jsx)("h2",{children:"GraphQL"}),Object(O.jsx)("hr",{}),Object(O.jsx)(p,{title:"Search",type:"text",name:"search",value:this.state.searchTerm,handleChange:this.handleChange}),Object(O.jsx)("div",{className:"list-group",children:e.map((function(e){return Object(O.jsxs)(o.b,{className:"list-group-item list-group-item-action",to:"/moviesgraphql/".concat(e.id),children:[Object(O.jsx)("strong",{children:e.title}),Object(O.jsx)("br",{}),Object(O.jsxs)("small",{className:"text-muted",children:["(",e.year,") - ",e.runtime," minutes"]}),Object(O.jsx)("br",{}),e.description.slice(0,100),"..."]},e.id)}))})]})}}]),n}(a.Component),x=function(e){Object(b.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(d.a)(this,n);for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return(e=t.call.apply(t,[this].concat(s))).state={movie:{},isLoaded:!1,error:null},e}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=this,t="\n    {\n        movie(id: ".concat(this.props.match.params.id,") {\n            id\n            title\n            runtime\n            year\n            description\n            release_date\n            rating\n            mpaa_rating\n            poster\n        }\n    }\n    "),n=new Headers;n.append("Content-Type","application/json");var a={method:"POST",body:t,headers:n};fetch("".concat("https://api.myqwerty.ru/v1","/graphql"),a).then((function(e){return e.json()})).then((function(t){e.setState({movie:t.data.movie,isLoaded:!0})}))}},{key:"render",value:function(){var e=this.state,t=e.movie,n=e.isLoaded,s=e.error;return t.genres?t.genres=Object.values(t.genres):t.genres=[],s?Object(O.jsxs)("div",{children:["Error: ",s.message]}):n?Object(O.jsxs)(a.Fragment,{children:[Object(O.jsxs)("h2",{children:["Movie: ",t.title," (",t.year,")"]}),""!==t.poster&&Object(O.jsx)("div",{children:Object(O.jsx)("img",{src:"https://image.tmdb.org/t/p/w200".concat(t.poster),alt:"poster"})}),Object(O.jsx)("div",{className:"float-start",children:Object(O.jsxs)("small",{children:["Rating: ",t.mpaa_rating]})}),Object(O.jsx)("div",{className:"float-end",children:t.genres.map((function(e,t){return Object(O.jsx)("span",{className:"badge bg-secondary me-1",children:e},t)}))}),Object(O.jsx)("div",{className:"clearfix"}),Object(O.jsx)("hr",{}),Object(O.jsxs)("table",{className:"table table-compact table-striped",children:[Object(O.jsx)("thead",{}),Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{children:Object(O.jsx)("strong",{children:"Title:"})}),Object(O.jsx)("td",{children:t.title})]}),Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{children:Object(O.jsx)("strong",{children:"Description:"})}),Object(O.jsx)("td",{children:t.description})]}),Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{children:Object(O.jsx)("strong",{children:"Run time:"})}),Object(O.jsxs)("td",{children:[t.runtime," minutes"]})]})]})]})]}):Object(O.jsx)("p",{children:"Loading..."})}}]),n}(a.Component);var g=function(e){var t=Object(a.useState)([]),n=Object(l.a)(t,2),s=n[0],c=n[1],r=Object(a.useState)(""),i=Object(l.a)(r,2),j=i[0],d=i[1];return Object(a.useEffect)((function(){fetch("".concat("https://api.myqwerty.ru/v1","/movies")).then((function(e){return 200!==e.status?d("invalid response code: ",e.status):d(null),e.json()})).then((function(e){c(e.movies)}))}),[]),null!==j?Object(O.jsxs)("div",{children:["Error: ",j.message]}):Object(O.jsxs)(a.Fragment,{children:[Object(O.jsx)("h2",{children:"Choose a movie"}),Object(O.jsx)("hr",{}),Object(O.jsx)("div",{className:"list-group",children:s.map((function(e){return Object(O.jsx)(o.b,{className:"list-group-item list-group-item-action",to:"/movies/".concat(e.id),children:e.title},e.id)}))})]})};var f=function(e){var t=Object(a.useState)([]),n=Object(l.a)(t,2),s=n[0],c=n[1],r=Object(a.useState)(""),i=Object(l.a)(r,2),j=i[0],d=i[1];return Object(a.useEffect)((function(){fetch("".concat("https://api.myqwerty.ru/v1","/genres")).then((function(e){return 200!==e.status?d("invalid response status: ",e.status):d(null),e.json()})).then((function(e){c(e.genres)}))}),[]),null!==j?Object(O.jsxs)("div",{children:["Error: ",j.message]}):Object(O.jsxs)(a.Fragment,{children:[Object(O.jsx)("h2",{children:"Genres"}),Object(O.jsx)("div",{className:"list-group",children:s.map((function(e){return Object(O.jsx)(o.b,{className:"list-group-item list-group-item-action",to:{pathname:"/genre/".concat(e.id),genreName:e.genre_name},children:e.genre_name},e.id)}))})]})};var y=function(e){var t=Object(a.useState)({}),n=Object(l.a)(t,2),s=n[0],c=n[1],r=Object(a.useState)(null),i=Object(l.a)(r,2),o=i[0],j=i[1];return Object(a.useEffect)((function(){fetch("".concat("https://api.myqwerty.ru/v1","/movie/")+e.match.params.id).then((function(e){return 200!==e.status?j("invalide response",e.status):j(null),e.json()})).then((function(e){c(e.movie)}))}),[e.match.params.id]),s.genres?s.genres=Object.values(s.genres):s.genres=[],null!==o?Object(O.jsxs)("div",{children:["Error: ",o.message]}):Object(O.jsxs)(a.Fragment,{children:[Object(O.jsxs)("h2",{children:["Movie: ",s.title," (",s.year,")"]}),Object(O.jsx)("div",{className:"float-start",children:Object(O.jsxs)("small",{children:["Rating: ",s.mpaa_rating]})}),Object(O.jsx)("div",{className:"float-end",children:s.genres.map((function(e,t){return Object(O.jsx)("span",{className:"badge bg-secondary me-1",children:e},t)}))}),Object(O.jsx)("div",{className:"clearfix"}),Object(O.jsx)("hr",{}),Object(O.jsxs)("table",{className:"table table-compact table-striped",children:[Object(O.jsx)("thead",{}),Object(O.jsxs)("tbody",{children:[Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{children:Object(O.jsx)("strong",{children:"Title:"})}),Object(O.jsx)("td",{children:s.title})]}),Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{children:Object(O.jsx)("strong",{children:"Description:"})}),Object(O.jsx)("td",{children:s.description})]}),Object(O.jsxs)("tr",{children:[Object(O.jsx)("td",{children:Object(O.jsx)("strong",{children:"Run time:"})}),Object(O.jsxs)("td",{children:[s.runtime," minutes"]})]})]})]})]})};var N=function(e){var t=Object(a.useState)([]),n=Object(l.a)(t,2),s=n[0],c=n[1],r=Object(a.useState)(null),i=Object(l.a)(r,2),j=i[0],d=i[1],h=Object(a.useState)(""),m=Object(l.a)(h,2),b=m[0],u=m[1];return Object(a.useEffect)((function(){fetch("".concat("https://api.myqwerty.ru/v1","/movies/")+e.match.params.id).then((function(e){return 200!==e.status?d("invalid response code",e.error):d(null),e.json()})).then((function(t){u(e.location.genreName),c(t.movies)}))}),[e.match.params.id,e.location.genreName]),s||(s=[]),null!==j?Object(O.jsxs)("div",{children:["Error: ",j.message]}):Object(O.jsxs)(a.Fragment,{children:[Object(O.jsxs)("h2",{children:["Genre: ",b]}),Object(O.jsx)("div",{className:"list-group",children:s.map((function(e){return Object(O.jsx)(o.b,{to:"/movies/".concat(e.id),className:"list-group-item list-group-item-action",children:e.title},e.id)}))})]})},w=n(12),S=(n(40),function(e){return Object(O.jsxs)("div",{className:"mb-3",children:[Object(O.jsxs)("label",{htmlFor:e.name,className:"form-label",children:[" ",e.title," "]}),Object(O.jsxs)("select",{className:"form-select",name:e.name,value:e.value,onChange:e.handleChange,children:[Object(O.jsx)("option",{value:"",children:e.placeholder}),e.options.map((function(e){return Object(O.jsx)("option",{className:"form-select",value:e.id,label:e.value,children:e.value},e.id)}))]})]})}),C=function(e){return Object(O.jsxs)("div",{className:"mb-3",children:[Object(O.jsx)("label",{htmlFor:"description",className:"form-label",children:e.title}),Object(O.jsx)("textarea",{className:"form-control",id:e.name,name:e.name,value:e.value,onChange:e.handleChange,rows:e.rows})]})},T=function(e){return Object(O.jsx)("div",{className:"alert ".concat(e.alertType),role:"alert",children:e.alertMessage})},E=n(25);n(41);var q=function(e){var t=Object(a.useState)({id:0,title:"",release_date:"",runtime:"",mpaa_rating:"Choose...",rating:"",description:""}),n=Object(l.a)(t,2),s=n[0],c=n[1],r=Object(a.useState)(null),j=Object(l.a)(r,2),d=j[0],h=j[1],m=Object(a.useState)([]),b=Object(l.a)(m,2),u=b[0],v=b[1],x=Object(a.useState)({type:"d-none",message:""}),g=Object(l.a)(x,2),f=g[0],y=g[1];Object(a.useEffect)((function(){if(""!==e.jwt){var t=e.match.params.id;t>0&&fetch("".concat("https://api.myqwerty.ru/v1","/movie/")+t).then((function(e){return 200!==e.status?h("invalide response",e.status):h(null),e.json()})).then((function(e){var t=new Date(e.movie.release_date);e.movie.release_date=t.toISOString().split("T")[0],c(e.movie)}))}else e.history.push({pathname:"/login"})}),[e.history,e.match.params.id,e.jwt]);var N=function(){return function(e){var t=e.target.value,n=e.target.name;c(Object(i.a)(Object(i.a)({},s),{},Object(w.a)({},n,t)))}};function q(e){return-1!==u.indexOf(e)}return null!==d?Object(O.jsxs)("div",{children:["Error: ",d.message]}):Object(O.jsxs)(a.Fragment,{children:[Object(O.jsx)("h2",{children:"Add/Edit Movie"}),Object(O.jsx)(T,{alertType:f.type,alertMessage:f.message}),Object(O.jsx)("hr",{}),Object(O.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n=[];if(""===s.title&&n.push("title"),v(n),n.length>0)return!1;var a=new FormData(t.target),c=Object.fromEntries(a.entries()),r=new Headers;r.append("Content-Type","application/json"),r.append("Authorization","Bearer "+e.jwt);var i={method:"POST",body:JSON.stringify(c),headers:r};fetch("".concat("https://api.myqwerty.ru/v1","/admin/editmovie"),i).then((function(e){return e.json()})).then((function(t){t.error?y({alert:{type:"alert-danger",message:t.error.message}}):e.history.push({pathname:"/admin"})}))},children:[Object(O.jsx)("input",{type:"hidden",name:"id",id:"id",value:s.id,onChange:N()}),Object(O.jsx)(p,{title:"Title",className:q("title")?"is-invalid":"",type:"text",name:"title",value:s.title,handleChange:N(),errorDiv:q("title")?"text-danger":"d-none",errorMsg:"Please enter a title"}),Object(O.jsx)(p,{title:"Release Date",type:"date",name:"release_date",value:s.release_date,handleChange:N()}),Object(O.jsx)(p,{title:"Runtime",type:"text",name:"runtime",value:s.runtime,handleChange:N()}),Object(O.jsx)(S,{title:"MPAA Rating",name:"mpaa_rating",options:[{id:"G",value:"G"},{id:"PG",value:"PG"},{id:"PG13",value:"PG13"},{id:"R",value:"R"},{id:"NC17",value:"NC17"}],value:s.mpaa_rating,handleChange:N(),placeholder:"Choose..."}),Object(O.jsx)(p,{title:"Rating",type:"text",name:"rating",value:s.rating,handleChange:N()}),Object(O.jsx)(C,{title:"Description",name:"description",value:s.description,rows:"3",handleChange:N()}),Object(O.jsx)("hr",{}),Object(O.jsx)("button",{className:"btn btn-primary",children:"Save"}),Object(O.jsx)(o.b,{to:"/admin",className:"btn btn-warning ms-1",children:"Cancel"}),s.id>0&&Object(O.jsx)("a",{href:"#!",onClick:function(){Object(E.confirmAlert)({title:"Delete Movie?",message:"Are you sure?",buttons:[{label:"Yes",onClick:function(){var t=new Headers;t.append("Content-Type","application/json"),t.append("Authorization","Bearer "+e.jwt),fetch("".concat("https://api.myqwerty.ru/v1","/admin/deletemovie/")+s.id,{method:"GET",headers:t}).then((function(e){return e.json})).then((function(t){t.error?y({type:"alert-danger",message:t.error.message}):(y({type:"alert-success",message:"Movie deleted!"}),e.history.push({pathname:"/admin"}))}))}},{label:"No",onClick:function(){}}]})},className:"btn btn-danger ms-1",children:"Delete"})]})]})};var M=function(e){var t=Object(a.useState)([]),n=Object(l.a)(t,2),s=n[0],c=n[1],r=Object(a.useState)(null),i=Object(l.a)(r,2),j=i[0],d=i[1];return Object(a.useEffect)((function(){""!==e.jwt?fetch("".concat("https://api.myqwerty.ru/v1","/movies")).then((function(e){return 200!==e.status?d("invalide response",e.status):d(null),e.json()})).then((function(e){c(e.movies)})):e.history.push({pathname:"/login"})}),[e.jwt,e.history]),null!==j?Object(O.jsxs)("div",{children:["Error: ",j.message]}):Object(O.jsxs)(a.Fragment,{children:[Object(O.jsx)("h2",{children:"Manage Catalogue"}),Object(O.jsx)("hr",{}),Object(O.jsx)("div",{className:"list-group",children:s.map((function(e){return Object(O.jsx)(o.b,{className:"list-group-item list-group-item-action",to:"/admin/movie/".concat(e.id),children:e.title},e.id)}))})]})},D=n.p+"static/media/nice_photo.81b356c7.jpeg";var F=function(e){return Object(O.jsxs)("div",{className:"text-center",children:[Object(O.jsx)("h2",{children:"Find a movie to watch tonight!"}),Object(O.jsx)("hr",{}),Object(O.jsx)(o.b,{to:"/movies",children:Object(O.jsx)("img",{className:"img-fluid",src:D,alt:"movie ticket"})})]})};var _=function(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),s=n[0],c=n[1],r=Object(a.useState)(""),i=Object(l.a)(r,2),o=i[0],j=i[1],d=Object(a.useState)([]),h=Object(l.a)(d,2),m=h[0],b=h[1],u=Object(a.useState)({type:"d-none",message:""}),v=Object(l.a)(u,2),x=v[0],g=v[1];function f(e){return-1!==m.indexOf(e)}return Object(O.jsxs)(a.Fragment,{children:[Object(O.jsx)("h2",{children:"Login"}),Object(O.jsx)("hr",{}),Object(O.jsx)(T,{alertType:x.type,alertMessage:x.message}),Object(O.jsxs)("form",{className:"pt-3",onSubmit:function(t){if(t.preventDefault(),""===s&&m.push("email"),""===o&&m.push("password"),b(m),m.length>0)return!1;var n=new FormData(t.target),a=Object.fromEntries(n.entries()),c={method:"POST",body:JSON.stringify(a)};fetch("".concat("https://api.myqwerty.ru/v1","/signin"),c).then((function(e){return e.json()})).then((function(t){var n;t.error?g({type:"alert-danger",message:"Invalid login"}):(n=Object.values(t)[0],e.handleJWTChange(n),window.localStorage.setItem("jwt",JSON.stringify(Object.values(t)[0])),e.history.push({pathname:"/admin"}))}))},children:[Object(O.jsx)(p,{title:"Email",type:"email",name:"email",handleChange:function(e){c(e.target.value)},className:f("email")?"is-invalid":"",errorDiv:f("email")?"text-danger":"d-none",errorMsg:"Please enter a valid email address"}),Object(O.jsx)(p,{title:"Password",type:"current-password",name:"password",handleChange:function(e){j(e.target.value)},className:f("password")?"is-invalid":"",errorDiv:f("password")?"text-danger":"d-none",errorMsg:"Please enter a password"}),Object(O.jsx)("hr",{}),Object(O.jsx)("button",{className:"btn btn-primary",children:"Login"})]})]})};function P(e){var t,n=Object(a.useState)(""),s=Object(l.a)(n,2),c=s[0],r=s[1];function d(e){r(e)}return Object(a.useEffect)((function(){var e=window.localStorage.getItem("jwt");e&&""===c&&r({jwt:JSON.parse(e)})}),[c]),t=""===c?Object(O.jsx)(o.b,{to:"/login",children:"Login"}):Object(O.jsx)(o.b,{to:"/logout",onClick:function(){r(""),window.localStorage.removeItem("jwt")},children:"Logout"}),Object(O.jsx)(o.a,{children:Object(O.jsxs)("div",{className:"container",children:[Object(O.jsxs)("div",{className:"row",children:[Object(O.jsx)("div",{className:"col mt-3",children:Object(O.jsx)("h1",{className:"mt-3",children:"Test application!"})}),Object(O.jsx)("div",{className:"col mt-3 text-end",children:t}),Object(O.jsx)("hr",{className:"mb-3"})]}),Object(O.jsxs)("div",{className:"row",children:[Object(O.jsx)("div",{className:"col-md-2",children:Object(O.jsx)("nav",{children:Object(O.jsxs)("ul",{className:"list-group",children:[Object(O.jsx)("li",{className:"list-group-item",children:Object(O.jsx)(o.b,{to:"/",children:"Home"})}),Object(O.jsx)("li",{className:"list-group-item",children:Object(O.jsx)(o.b,{to:"/movies",children:"Movies"})}),Object(O.jsx)("li",{className:"list-group-item",children:Object(O.jsx)(o.b,{to:"/genres",children:"Genres"})}),""!==c&&Object(O.jsxs)(a.Fragment,{children:[Object(O.jsx)("li",{className:"list-group-item",children:Object(O.jsx)(o.b,{to:"/admin/movie/0",children:"Add movie"})}),Object(O.jsx)("li",{className:"list-group-item",children:Object(O.jsx)(o.b,{to:"/admin",children:"Manage Catalogue"})})]}),Object(O.jsx)("li",{className:"list-group-item",children:Object(O.jsx)(o.b,{to:"/graphql",children:"GraphQL"})})]})})}),Object(O.jsx)("div",{className:"col-md-10",children:Object(O.jsxs)(j.c,{children:[Object(O.jsx)(j.a,{path:"/movies/:id",component:y}),Object(O.jsx)(j.a,{path:"/moviesgraphql/:id",component:x}),Object(O.jsx)(j.a,{path:"/movies",children:Object(O.jsx)(g,{})}),Object(O.jsx)(j.a,{path:"/genre/:id",component:N}),Object(O.jsx)(j.a,{exact:!0,path:"/login",component:function(e){return Object(O.jsx)(_,Object(i.a)(Object(i.a)({},e),{},{handleJWTChange:d}))}}),Object(O.jsx)(j.a,{exact:!0,path:"/genres",children:Object(O.jsx)(f,{})}),Object(O.jsx)(j.a,{exact:!0,path:"/graphql",children:Object(O.jsx)(v,{})}),Object(O.jsx)(j.a,{path:"/admin/movie/:id",component:function(e){return Object(O.jsx)(q,Object(i.a)(Object(i.a)({},e),{},{jwt:c}))}}),Object(O.jsx)(j.a,{path:"/admin",component:function(e){return Object(O.jsx)(M,Object(i.a)(Object(i.a)({},e),{},{jwt:c}))}}),Object(O.jsx)(j.a,{path:"/",children:Object(O.jsx)(F,{})})]})})]})]})})}r.a.render(Object(O.jsx)(s.a.StrictMode,{children:Object(O.jsx)(P,{})}),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.4c723ace.chunk.js.map